{{- $cfg := .Values.config | default dict }}
{{- $valkey := $cfg.valkey | default dict }}
{{- $tokenSalt := tpl (default "" $cfg.tokenSalt) . | trim }}
{{- $valkeyUsername := tpl (default "" $valkey.username) . | trim }}
{{- $valkeyPassword := tpl (default "" $valkey.password) . | trim }}
{{- if or $tokenSalt $valkeyUsername $valkeyPassword }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-config" (include "rusty-valkey-forward-auth.fullname" .) }}
  labels:
    {{- include "rusty-valkey-forward-auth.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if $tokenSalt }}
  token-salt: {{ $tokenSalt | quote }}
  {{- end }}
  {{- if $valkeyUsername }}
  valkey-username: {{ $valkeyUsername | quote }}
  {{- end }}
  {{- if $valkeyPassword }}
  valkey-password: {{ $valkeyPassword | quote }}
  {{- end }}
{{- end }}
